<!-- src/app/chat-widget/chat-widget.component.html -->

<!-- The floating button to open the chat -->
<button *ngIf="!isOpen" class="chat-open-button" (click)="handleOpenChat()" aria-label="Open Chat">
  <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
    <path d="M8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6-.097 1.016-.417 2.13-.771 2.966-.079.186.074.394.273.362 2.256-.37 3.597-.938 4.18-1.234A9.06 9.06 0 0 0 8 15z"/>
  </svg>
</button>

<!-- The actual chat widget window -->
<div class="chat-widget-container" [ngClass]="{ 'open': isOpen, 'closed': !isOpen, 'maximized': isMaximized }">
  <header class="widget-header">
    <h3>IT Support Assistant</h3>
    <div class="widget-controls">
      <button (click)="toggleMaximize()" [attr.aria-label]="isMaximized ? 'Restore Chat' : 'Maximize Chat'">
        <svg *ngIf="!isMaximized" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0 .707 0l4.096-4.096V9.5a.5.5 0 0 0 1 0V5.5a.5.5 0 0 0-.5-.5H6.5a.5.5 0 0 0 0 1h2.793L5.121 9.465a.5.5 0 0 0 0 .707z"/></svg>
        <svg *ngIf="isMaximized" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M3.05a.5.5 0 0 1 .5.5V5h1.5a.5.5 0 0 1 0 1H3.5a.5.5 0 0 1-.5-.5V3.5a.5.5 0 0 1 .5-.5a.5.5 0 0 1 .5.5v.5zM10 .5a.5.5 0 0 1 .5-.5h2.5a.5.5 0 0 1 .5.5v2.5a.5.5 0 0 1-1 0V1H10.5a.5.5 0 0 1-.5-.5z"/></svg>
      </button>
      <button (click)="isOpen = false" aria-label="Minimize Chat">—</button>
      <button (click)="isOpen = false" aria-label="Close Chat">✖</button>
    </div>
  </header>

  <main class="chat-content">
    <div *ngIf="isLoading" class="widget-loading-container">
      <div class="spinner"></div>
    </div>
    <div *ngIf="error" class="widget-error-banner">{{ error }}</div>

    <div #scrollContainer class="chat-window">
      <app-message *ngFor="let msg of messages" [message]="msg"></app-message>
      <div *ngIf="isTyping" class="typing-indicator">Bot is typing...</div>
    </div>
  </main>

  <form class="chat-input-form" (ngSubmit)="handleSendMessage()">
    <input
      type="text"
      class="chat-input"
      [(ngModel)]="inputValue"
      name="messageInput"
      [placeholder]="isFormDisabled() ? 'Please wait...' : 'Type your message here...'"
      [disabled]="isFormDisabled()"
      autocomplete="off"
    />
    <button type="submit" class="send-button" [disabled]="isFormDisabled()">➤</button>
  </form>
</div>
