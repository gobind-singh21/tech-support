<!-- src/app/chat-widget/chat-widget.component.html -->

<!-- The floating button to open the chat -->
<button *ngIf="!isOpen" class="chat-open-button" (click)="handleOpenChat()" aria-label="Open Chat">
  <!-- New Icon for IndiaFirst theme -->
  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
  </svg>
</button>

<!-- The actual chat widget window (no 'maximized' class) -->
<div class="chat-widget-container" [ngClass]="{ 'open': isOpen, 'closed': !isOpen }">
  <header class="widget-header">
    <h3>Virtual Assistant</h3>
    <div class="widget-controls">
      <!-- Maximize button is removed -->
      <button (click)="isOpen = false" aria-label="Close Chat">✖</button>
    </div>
  </header>

  <main class="chat-content">
    <div *ngIf="isLoading" class="widget-loading-container"><div class="spinner"></div></div>
    <div *ngIf="error" class="widget-error-banner">{{ error }}</div>

    <div #scrollContainer class="chat-window">
      <app-message *ngFor="let msg of messages" [message]="msg"></app-message>
      <div *ngIf="isTyping" class="typing-indicator">Bot is typing...</div>
    </div>
  </main>

  <form class="chat-input-form" (ngSubmit)="handleSendMessage()">
    <input type="text" class="chat-input" [(ngModel)]="inputValue" name="messageInput"
           [placeholder]="isFormDisabled() ? 'Please wait...' : 'Type your message here...'"
           [disabled]="isFormDisabled()" autocomplete="off"/>
    <button type="submit" class="send-button" [disabled]="isFormDisabled()">➤</button>
  </form>
</div>
